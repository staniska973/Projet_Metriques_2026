<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Histogramme Paris</title>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 24px;
      }

      #chart {
        width: 100%;
        height: 520px;
      }

      #status {
        margin-top: 10px;
      }

      .retour {
        display: inline-block;
        margin-bottom: 12px;
        text-decoration: none;
        background: #6b7280;
        color: white;
        padding: 8px 12px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <a class="retour" href="/">Retour à l'accueil</a>
    <h1>Prévisions météo - Paris (Histogramme)</h1>
    <div id="chart"></div>
    <div id="status">Chargement en cours...</div>

    <script>
      google.charts.load('current', { packages: ['corechart'] });
      google.charts.setOnLoadCallback(init);

      async function init() {
        try {
          const rows = await chargerDonnees();
          dessiner(rows);
          setStatus('OK - Données chargées depuis /paris-journalier');
        } catch (erreur) {
          setStatus('Erreur: ' + (erreur.message || erreur));
        }
      }

      async function chargerDonnees() {
        const reponse = await fetch('/paris-journalier', {
          headers: { Accept: 'application/json' }
        });

        if (!reponse.ok) {
          throw new Error('HTTP ' + reponse.status + ' sur /paris-journalier');
        }

        const json = await reponse.json();
        return json.map(point => [point.date, Number(point.temperature_max_c)]);
      }

      function dessiner(rows) {
        const data = new google.visualization.DataTable();
        data.addColumn('string', 'Jour');
        data.addColumn('number', 'Température max (°C)');
        data.addRows(rows);

        const options = {
          title: 'Température max à Paris - 7 jours',
          legend: { position: 'none' },
          hAxis: { title: 'Jour' },
          vAxis: { title: '°C' },
          colors: ['#4285F4']
        };

        const chart = new google.visualization.ColumnChart(document.getElementById('chart'));
        chart.draw(data, options);
      }

      function setStatus(message) {
        document.getElementById('status').textContent = message;
      }
    </script>
  </body>
</html>
